



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Pact Developer Tutorials">
      
      
      
        <meta name="author" content="Kadena">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>3. Safety Using Control Flow - Pact Developer Tutorials</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#00bcd4">
      
    
    
      <script src="../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Helvetica:300,400,400i,700|Helvetica">
        <style>body,input{font-family:"Helvetica","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Helvetica","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#safety-using-control-flow" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Pact Developer Tutorials" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Pact Developer Tutorials
              </span>
              <span class="md-header-nav__topic">
                3. Safety Using Control Flow
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/kadena-io/pact/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      kadena-io/pact
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../beginner/welcome-to-pact/" title="Beginner" class="md-tabs__link">
          Beginner
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../deploy-local-server/" title="Intermediate" class="md-tabs__link md-tabs__link--active">
          Intermediate
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../advanced/coming-soon/" title="Advanced" class="md-tabs__link">
          Advanced
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Pact Developer Tutorials" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Pact Developer Tutorials
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/kadena-io/pact/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      kadena-io/pact
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Beginner
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Beginner
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/welcome-to-pact/" title="1. Welcome to Pact" class="md-nav__link">
      1. Welcome to Pact
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/online-editor/" title="2. Online Editor" class="md-nav__link">
      2. Online Editor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/hello-world-with-pact/" title="3. Hello World" class="md-nav__link">
      3. Hello World
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/pact-language-basics/" title="4. Language Basics" class="md-nav__link">
      4. Language Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/pact-modules/" title="5. Modules" class="md-nav__link">
      5. Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/pact-keysets/" title="6. Keysets" class="md-nav__link">
      6. Keysets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/pact-schemas-and-tables/" title="7. Schemas and Tables" class="md-nav__link">
      7. Schemas and Tables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/pact-on-atom-sdk/" title="8. Atom SDK" class="md-nav__link">
      8. Atom SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/pact-accounts-and-transfers/" title="9. Accounts and Transfers" class="md-nav__link">
      9. Accounts and Transfers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/contract-interaction/" title="10. Contract Interaction" class="md-nav__link">
      10. Contract Interaction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/project-rotatable-wallet/" title="11. Project: Rotatable Wallet" class="md-nav__link">
      11. Project: Rotatable Wallet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/project-loans/" title="12. Project: Loans" class="md-nav__link">
      12. Project: Loans
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../beginner/testing-pact-code-in-the-sdk/" title="13. Test in the SDK" class="md-nav__link">
      13. Test in the SDK
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Intermediate
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Intermediate
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy-local-server/" title="1. Deploy to a Local Server" class="md-nav__link">
      1. Deploy to a Local Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pact-and-javascript/" title="2. Pact and Javascript" class="md-nav__link">
      2. Pact and Javascript
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        3. Safety Using Control Flow
      </label>
    
    <a href="./" title="3. Safety Using Control Flow" class="md-nav__link md-nav__link--active">
      3. Safety Using Control Flow
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#control-flow" title="Control Flow" class="md-nav__link">
    Control Flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-considered-harmful" title="“If” considered harmful" class="md-nav__link">
    “If” considered harmful
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-enforce-instead" title="Use enforce Instead" class="md-nav__link">
    Use enforce Instead
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-demonstration" title="Code Demonstration" class="md-nav__link">
    Code Demonstration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-project-locally" title="Open Project Locally" class="md-nav__link">
    Open Project Locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-the-project" title="View the Project" class="md-nav__link">
    View the Project
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-1-unsafe" title="Demonstration #1: Unsafe" class="md-nav__link">
    Demonstration #1: Unsafe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-1-safe" title="Demonstration #1: Safe" class="md-nav__link">
    Demonstration #1: Safe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-2-unsafe" title="Demonstration #2: Unsafe" class="md-nav__link">
    Demonstration #2: Unsafe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-2-safe" title="Demonstration #2: Safe" class="md-nav__link">
    Demonstration #2: Safe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-coinrepl" title="my-coin.repl" class="md-nav__link">
    my-coin.repl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review" title="Review" class="md-nav__link">
    Review
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interfaces-with-pact/" title="4. Interfaces with Pact" class="md-nav__link">
      4. Interfaces with Pact
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Advanced
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced/coming-soon/" title="Coming Soon" class="md-nav__link">
      Coming Soon
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#control-flow" title="Control Flow" class="md-nav__link">
    Control Flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#if-considered-harmful" title="“If” considered harmful" class="md-nav__link">
    “If” considered harmful
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-enforce-instead" title="Use enforce Instead" class="md-nav__link">
    Use enforce Instead
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-demonstration" title="Code Demonstration" class="md-nav__link">
    Code Demonstration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#open-project-locally" title="Open Project Locally" class="md-nav__link">
    Open Project Locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-the-project" title="View the Project" class="md-nav__link">
    View the Project
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-1-unsafe" title="Demonstration #1: Unsafe" class="md-nav__link">
    Demonstration #1: Unsafe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-1-safe" title="Demonstration #1: Safe" class="md-nav__link">
    Demonstration #1: Safe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-2-unsafe" title="Demonstration #2: Unsafe" class="md-nav__link">
    Demonstration #2: Unsafe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#demonstration-2-safe" title="Demonstration #2: Safe" class="md-nav__link">
    Demonstration #2: Safe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-coinrepl" title="my-coin.repl" class="md-nav__link">
    my-coin.repl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review" title="Review" class="md-nav__link">
    Review
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kadena-io/pact/edit/master/docs/intermediate/safety-with-pact.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="safety-using-control-flow">Safety Using Control Flow<a class="headerlink" href="#safety-using-control-flow" title="Permanent link">&para;</a></h1>
<p>Welcome to this tutorial on <strong>Safety Using Control Flow</strong> with Pact.</p>
<p>While Pact is already a simple and safe language for smart contracts, there are a few patterns and recommendations you can follow to make it even simpler and even safer. Throughout the next few tutorials, we’ll discuss a few of these patterns.</p>
<p>In this tutorial, we’ll focus specifically on how Pact avoids control flow to ensure safety.</p>
<p><strong>Topics covered in this tutorial</strong></p>
<ul>
<li>Control Flow</li>
<li>Project Setup</li>
<li>Unsafe/Safe Example #1</li>
<li>Unsafe/Safe Example #2</li>
</ul>
<div class="admonition summary">
<p class="admonition-title">Key Takeaway</p>
<p>When writing Pact smart contracts, avoid using <a href="https://pact-language.readthedocs.io/en/stable/pact-functions.html#if" target="_blank">if</a> statements. Instead, use <a href="https://pact-language.readthedocs.io/en/stable/pact-functions.html#enforce" target="_blank">enforce</a> to ensure your code is both simpler and safer.</p>
</div>
<hr />
<h2 id="control-flow"><strong>Control Flow</strong><a class="headerlink" href="#control-flow" title="Permanent link">&para;</a></h2>
<p><em>Control flow</em> is the order in which individual statements, instructions or function calls are evaluated.</p>
<p>In Pact, like in many languages, there are a few ways to approach control flow in your applications. Using Pact, you can use either if or enforce as a means to control the flow of your application. While you can technically use either, we recommend using enforce whenever possible. Using if is considered harmful to the application.</p>
<h2 id="if-considered-harmful"><strong>“If” considered harmful</strong><a class="headerlink" href="#if-considered-harmful" title="Permanent link">&para;</a></h2>
<p>Here is an example of an <strong>if</strong> statement using Pact.</p>
<div class="codehilite"><pre><span></span><span class="nv">pact&gt;</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span> <span class="s">&quot;Don’t use if statements&quot;</span> <span class="s">&quot;Use enforce instead&quot;</span><span class="p">)</span>
<span class="s">&quot;Don’t use if statements&quot;</span>
</pre></div>


<p>Consider avoiding <strong>if</strong> whenever possible. Every branch makes code harder to understand, opening up the possibility of bugs in your code. </p>
<div class="admonition summary">
<p class="admonition-title">Pact History</p>
<p>Pact’s original design left out if altogether (and looping), but it was decided that users should be able to judiciously use these features as necessary.</p>
</div>
<h2 id="use-enforce-instead"><strong>Use enforce Instead</strong><a class="headerlink" href="#use-enforce-instead" title="Permanent link">&para;</a></h2>
<p>Enforce is considered a safer option for your smart contracts by making code simpler and less prone to bugs. </p>
<p>Here is an example of an <strong>enforce</strong> statement using Pact.</p>
<div class="codehilite"><pre><span></span><span class="nv">pact&gt;</span> <span class="p">(</span><span class="nf">enforce</span> <span class="p">(</span><span class="nf">!=</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span> <span class="s">&quot;Stay Safe. Enforce the law.&quot;</span><span class="p">)</span>
<span class="nv">&lt;interactive&gt;</span><span class="ss">:0:0</span><span class="err">:</span> <span class="nv">Stay</span> <span class="nv">safe.</span> <span class="nv">Enforce</span> <span class="nv">the</span> <span class="nv">law.</span>
</pre></div>


<p><strong>If</strong> should never be used to enforce business logic invariants. Instead, <a href="https://pact-language.readthedocs.io/en/stable/pact-functions.html#enforce" target="_blank">enforce</a> is the right choice, which will fail the transaction.</p>
<div class="admonition summary">
<p class="admonition-title">Note</p>
<p>You can view more on Control Flow <a href="https://pact-language.readthedocs.io/en/stable/pact-reference.html#control-flow" target="_blank">here</a>.</p>
</div>
<p>Next, you will walk through a demonstration smart contract using if statements. You will then refactor these to use the safe option, enforce.</p>
<hr />
<h2 id="code-demonstration"><strong>Code Demonstration</strong><a class="headerlink" href="#code-demonstration" title="Permanent link">&para;</a></h2>
<p>For this demonstration, we have built a smart contract named <strong>my-coin</strong>. This project represents a simple ledger system providing transfer, credit, debit, account creation, and querying. The goal of this demonstration is to develop a smart contract that adheres to the best control flow safety practices. You’ll work on this contract through the remainder of the tutorial.</p>
<h3 id="open-project-locally"><strong>Open Project Locally</strong><a class="headerlink" href="#open-project-locally" title="Permanent link">&para;</a></h3>
<p>To start, open your terminal and change into your project directory.</p>
<div class="codehilite"><pre><span></span>cd projectDirectory
</pre></div>


<p>Clone the project repo.</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/kadena-io/pact-lang.org-code.git
</pre></div>


<p>Change into the control-flow project directory.</p>
<div class="codehilite"><pre><span></span>cd pact-lang.org-code/safety/control-flow
</pre></div>


<p>Open the project in atom.</p>
<div class="codehilite"><pre><span></span>atom .
</pre></div>


<h3 id="view-the-project"><strong>View the Project</strong><a class="headerlink" href="#view-the-project" title="Permanent link">&para;</a></h3>
<p>In this project you should see both the <strong>my-coin.pact</strong> and <strong>my-coin.repl</strong> files.</p>
<p><img alt="1-project-file" src="../../assets/intermediate-tutorials/safety-with-pact/1-project-file.png" /></p>
<p>Within the <strong>my-coin.pact</strong> file you will see both unsafe and safe alternatives for this program. You can view the completed files in the <strong>complete</strong> folder and the code challenges from within the <strong>challenge</strong> folder. </p>
<p>Throughout the rest of this tutorial, I’ll work in the challenge folder and demonstrate the 2 examples from this file.  First, by writing the unsafe alternative using if, then by writing the safer alternative using <strong>enforce</strong>.</p>
<hr />
<h2 id="demonstration-1-unsafe"><strong>Demonstration #1: Unsafe</strong><a class="headerlink" href="#demonstration-1-unsafe" title="Permanent link">&para;</a></h2>
<p>Starting in the <strong>debit-if</strong> function, you can see that there is an opportunity to use an <strong>if</strong> statement.</p>
<p>Taking a step back, you’ll see that this function is meant to debit a certain <strong>AMOUNT</strong> from an <strong>ACCOUNT</strong> balance while recording both the <strong>DATE</strong> and <strong>DATA</strong>. The opportunity for the if statement is at the point where we need to check if the balance is sufficient for the transfer. </p>
<div class="codehilite"><pre><span></span>  <span class="c1">;; Debit using if</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">debit-if</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Debit AMOUNT from ACCOUNT balance recording DATE and DATA&quot;</span>
      <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
        <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="ss">:=</span> <span class="nv">balance</span> <span class="p">}</span>
        <span class="c1">;;Check if balance is sufficient for the transfer</span>
          <span class="c1">;;STEP 1: UNSAFE IF STATEMENT GOES HERE</span>
          <span class="c1">;;STEP 2: If condition is true, update my-coin-table</span>


          <span class="c1">;;STEP 3:If condition is false, print message</span>

         <span class="p">)</span>
</pre></div>


<p>As you can see, we want to check that the amount being transferred is greater than the balance.</p>
<p><strong>STEP 1: Write If Statement</strong></p>
<p>A perfectly unsafe way to do this would be to write an if statement as shown here. </p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span>
</pre></div>


<p><strong>STEP 2: If the Condition is TRUE</strong></p>
<p>If the statement is true, meaning the balance is sufficient to make the transfer, the <strong>if</strong> statement will go on to update the <strong>account</strong> from within the <strong>my-coin-table</strong>.</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nf">update</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
    <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="err">:</span> <span class="p">(</span><span class="nb">- </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span> <span class="p">})</span>
</pre></div>


<p><strong>STEP 3: If the Condition is FALSE</strong>
If the statement is false, meaning the balance is insufficient to make the transfer, send an error message.</p>
<div class="codehilite"><pre><span></span> <span class="c1">;;If condition is false, print message</span>
 <span class="s">&quot;Balance is not sufficient for transfer&quot;</span> <span class="p">))</span>
</pre></div>


<p><strong>Final If Statement Code</strong></p>
<p>Here is a look at the final code. </p>
<div class="codehilite"><pre><span></span>   <span class="c1">;; Debit using if</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">debit-if</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Debit AMOUNT from ACCOUNT balance&quot;</span>
      <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
        <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="ss">:=</span> <span class="nv">balance</span> <span class="p">}</span>
        <span class="c1">;;Check if balance is sufficient for the transfer</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span>
          <span class="c1">;;If condition is true, update my-coin-table</span>
          <span class="p">(</span><span class="nf">update</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
            <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="err">:</span> <span class="p">(</span><span class="nb">- </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span> <span class="p">})</span>
          <span class="c1">;;If condition is false, print message</span>
          <span class="s">&quot;Balance is not sufficient for transfer&quot;</span> <span class="p">)))</span>
</pre></div>


<p>This is a clear case where it feels like <strong>if</strong> makes sense to use in your code. However, for reasons mentioned earlier, we’d like to remove <strong>if</strong> from our code in favor of <strong>enforce</strong>. </p>
<hr />
<h2 id="demonstration-1-safe"><strong>Demonstration #1: Safe</strong><a class="headerlink" href="#demonstration-1-safe" title="Permanent link">&para;</a></h2>
<p>Now, let’s refactor this code using enforce. In this case, the function is similar but we’ll make the safe decision and use enforce.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">;; refactor with enforce</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">debit</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Debit AMOUNT from ACCOUNT balance&quot;</span>
      <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
        <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="ss">:=</span> <span class="nv">balance</span> <span class="p">}</span>
        <span class="c1">;;STEP 1: Enforce the condition, and fail transaction if condition doesn&#39;t meet.</span>

        <span class="c1">;;STEP 2: Update the balance.</span>


        <span class="p">)</span>
</pre></div>


<p>As you can see, you’ll need to <strong>enforce</strong> the condition without using an <strong>if</strong> statement, then update the <strong>my-coin-table</strong> as you had done previously. </p>
<p><strong>STEP 1: Write Enforce Statement</strong></p>
<p>To start, enforce that the balance is greater than the amount being sent and fail the transaction if the condition isn’t met. </p>
<div class="codehilite"><pre><span></span><span class="c1">;; Enforce the condition, and fail transaction if condition doesn&#39;t meet.</span>
<span class="p">(</span><span class="nf">enforce</span> <span class="p">(</span><span class="nb">&gt; </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span> <span class="s">&quot;Balance is not sufficient for transfer&quot;</span><span class="p">)</span>
</pre></div>


<p>This step is very similar to the if statement but allows us to finish the function using simpler logic. </p>
<p><strong>STEP 2: Update the my-coin-table Table</strong></p>
<p>Since the <strong>enforce</strong> statement handled the failing scenario, you can now write the update to the my-coin-table account assuming that the <strong>enforce</strong> statement has passed. Update the balance of the account in my-coin-table to be the balance minus the amount sent.</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nf">update</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
    <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="err">:</span> <span class="p">(</span><span class="nb">- </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span> <span class="p">}))</span>
</pre></div>


<p><strong>Final Enforce Statement</strong></p>
<p>By using <strong>enforce</strong>, you no longer need to create branching logic dependent on the outcome of the if statement.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">;; refactor with enforce</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">debit</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Debit AMOUNT from ACCOUNT balance&quot;</span>
      <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
        <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="ss">:=</span> <span class="nv">balance</span> <span class="p">}</span>
        <span class="c1">;; Enforce the condition, and fail transaction if condition doesn&#39;t meet.</span>
        <span class="p">(</span><span class="nf">enforce</span> <span class="p">(</span><span class="nb">&gt; </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span> <span class="s">&quot;Balance is not sufficient for transfer&quot;</span><span class="p">)</span>
        <span class="c1">;;Update the balance.</span>
        <span class="p">(</span><span class="nf">update</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
          <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="err">:</span> <span class="p">(</span><span class="nb">- </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span> <span class="p">})))</span>
</pre></div>


<p>Keep this pattern in mind and use enforce rather than if to create simpler, safer Pact code.</p>
<hr />
<h2 id="demonstration-2-unsafe"><strong>Demonstration #2: Unsafe</strong><a class="headerlink" href="#demonstration-2-unsafe" title="Permanent link">&para;</a></h2>
<p>Next, I’ll walk through another demonstration showing the difference between <strong>if</strong> and <strong>enforce</strong>. This is another situation where it may be tempting to use <strong>if</strong>. Though it is a similar idea, there are a few subtle differences in this demonstration that will be valuable to understand.</p>
<p>Here is a look at the starting code.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">;;TEMPTING USE of &quot;IF&quot; (type 2)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">credit-if</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">keyset</span><span class="ss">:keyset</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Credit AMOUNT to ACCOUNT balance&quot;</span>

   <span class="c1">;;STEP 1: Fetch all keys in my-coin-table and see if account exists.</span>


    <span class="c1">;;STEP 2: if the row exists, check keyset and update the balance</span>


       <span class="c1">;;STEP 3: If the keysets do match, update the balance.</span>
       <span class="c1">;;Otherwise, print error message.</span>





    <span class="c1">;;STEP 4: if the row does not exist, insert a row into the table.</span>



      <span class="p">))</span>
</pre></div>


<p>As you can see, you’ll need to check that an account exists, update its balance if the row exists or if the keysets match, or insert a row if it does not exist. Each of these cases make it tempting to use <strong>if</strong>. For that reason, I’ll walk through now coding each line using <strong>if</strong> statements.</p>
<p><strong>Step 1: Check that Account Exists</strong></p>
<p>First, fetch all keys in my-coin-table to see if the account exists. </p>
<div class="codehilite"><pre><span></span><span class="c1">;;STEP 1: Fetch all keys in my-coin-table and see if account exists.If true, go to step 2, or else go to step 4</span>
<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">contains</span> <span class="nv">account</span> <span class="p">(</span><span class="nb">keys </span><span class="nv">my-coin-table</span><span class="p">))</span>
</pre></div>


<p><strong>Step 2: Update Balance if Row Exists</strong></p>
<p>Within the if statement, check the keyset and update the balance if it is found that the row exists.</p>
<div class="codehilite"><pre><span></span>    <span class="c1">;;STEP 2: if the row exists, bind variables</span>
    <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span> <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="ss">:=</span> <span class="nv">balance</span>,
                                       <span class="s">&quot;keyset&quot;</span><span class="ss">:=</span> <span class="nv">retk</span> <span class="p">}</span>
</pre></div>


<p><strong>Step 3: Update Balance if Keysets Match</strong></p>
<p>Then, if the keysets match update the balance. </p>
<div class="codehilite"><pre><span></span>       <span class="c1">;;STEP 3: If the keysets do match, update the balance.</span>
       <span class="c1">;;Otherwise, print error message.</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">retk</span> <span class="nv">keyset</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">update</span> <span class="nv">my-coin-table</span> <span class="nv">account</span> <span class="p">{</span>
           <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">amount</span> <span class="nv">balance</span><span class="p">)})</span>
         <span class="s">&quot;The keysets do not match&quot;</span> <span class="p">))</span>
</pre></div>


<p><strong>Step 4: Insert Row if it Does not Exist</strong></p>
<p>Next, if the row does not exist, insert the balance and keyset into the account on my-coin-table.</p>
<div class="codehilite"><pre><span></span>    <span class="c1">;;STEP 4: if the row does not exist, insert a row into the table.</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">my-coin-table</span> <span class="nv">account</span><span class="p">{</span>
       <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="nv">amount</span>,
       <span class="s">&quot;keyset&quot;</span><span class="err">:</span> <span class="nv">keyset</span>
      <span class="p">}))</span>
</pre></div>


<p><strong>Final Unsafe Code Using If</strong></p>
<p>Looking back at the final code, we can see that it is working, but that it is using an unsafe <strong>if</strong> statement. This is causing logic that is more complicated than necessary and is something that would be better written using <strong>enforce</strong>.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">;;TEMPTING USE of &quot;IF&quot; (type 2)</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">credit-if</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">keyset</span><span class="ss">:keyset</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Credit AMOUNT to ACCOUNT balance recording DATE and DATA&quot;</span>

   <span class="c1">;;STEP 1: Fetch all keys in my-coin-table and see if account exists.</span>
   <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">contains</span> <span class="nv">account</span> <span class="p">(</span><span class="nb">keys </span><span class="nv">my-coin-table</span><span class="p">))</span>

    <span class="c1">;;STEP 2: if the row exists, check keyset and update the balance</span>
    <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span> <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="ss">:=</span> <span class="nv">balance</span>,
                                       <span class="s">&quot;keyset&quot;</span><span class="ss">:=</span> <span class="nv">retk</span> <span class="p">}</span>
       <span class="c1">;;STEP 3: If the keysets do match, update the balance.</span>
       <span class="c1">;;Otherwise, print error message.</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">retk</span> <span class="nv">keyset</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">update</span> <span class="nv">my-coin-table</span> <span class="nv">account</span> <span class="p">{</span>
           <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">amount</span> <span class="nv">balance</span><span class="p">)})</span>
         <span class="s">&quot;The keysets do not match&quot;</span> <span class="p">))</span>

    <span class="c1">;;STEP 4: if the row does not exist, insert a row into the table.</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">my-coin-table</span> <span class="nv">account</span><span class="p">{</span>
       <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="nv">amount</span>,
       <span class="s">&quot;keyset&quot;</span><span class="err">:</span> <span class="nv">keyset</span>
      <span class="p">})))</span>
</pre></div>


<p>This code can be refactored using <strong>enforce</strong>.</p>
<hr />
<h2 id="demonstration-2-safe"><strong>Demonstration #2: Safe</strong><a class="headerlink" href="#demonstration-2-safe" title="Permanent link">&para;</a></h2>
<p>Take some time now to reconsider the code you wrote previously. Read through the new comments and decide how you may be able to approach writing this same logic with enforce rather than if.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">;;refactor with with-default-read &amp; write &amp; enforce</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">credit</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">keyset</span><span class="ss">:keyset</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Credit AMOUNT to ACCOUNT balance recording DATE and DATA&quot;</span>

    <span class="c1">;;STEP 1: Default the row to balance at 0.0 and keyset at input keyset</span>
    <span class="c1">;;If row exists, then bind balance and keyset value from the table.</span>
    <span class="c1">;;This allows one time key lookup - increases efficiency.</span>



      <span class="c1">;;STEP 2: Check that the input keyset is the same as the row&#39;s keyset</span>


      <span class="c1">;;STEP 3: Writes the row to the table. (write adds the table with the key and the row.</span>




<span class="p">)</span>
</pre></div>


<p>As you can see, you will again need to check that an account exists, update its balance if the row exists or if the keysets match, or insert a row if it does not exist. You can do all of this using <strong>enforce</strong> as shown below.</p>
<p><strong>Step 1: Create Efficient One Time Key Lookup</strong></p>
<p>To start, you will need to reorder the code slightly.</p>
<p>You’ll start by setting the default row balance to 0.0 and a keyset at input keyset. If the row exists, then bind the balance and keyset value from the table. </p>
<div class="codehilite"><pre><span></span>    <span class="c1">;;STEP 1: Default the row to balance at 0.0 and keyset at input keyset</span>
    <span class="c1">;;If row exists, then bind balance and keyset value from the table.</span>
    <span class="c1">;;This allows one time key lookup - increases efficiency.</span>
    <span class="p">(</span><span class="nf">with-default-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
      <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="mf">0.0</span>, <span class="s">&quot;keyset&quot;</span><span class="err">:</span> <span class="nv">keyset</span> <span class="p">}</span>
      <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="ss">:=</span> <span class="nv">balance</span>, <span class="s">&quot;keyset&quot;</span><span class="ss">:=</span> <span class="nv">retg</span> <span class="p">}</span>
</pre></div>


<p>This is more efficient than the previous code and allows for a one time key lookup. </p>
<p><strong>Previous Code Using If</strong></p>
<p>As a comparison, look back at steps 2 and 4 from the earlier code you wrote. Take some time to understand how the code above is combining each of these steps by allowing for a single lookup. </p>
<div class="codehilite"><pre><span></span>    <span class="err">…</span><span class="nv">code</span>

    <span class="c1">;;STEP 2: if the row exists, check keyset and update the balance</span>
    <span class="p">(</span><span class="nf">with-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span> <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="ss">:=</span> <span class="nv">balance</span>,
                                       <span class="s">&quot;keyset&quot;</span><span class="ss">:=</span> <span class="nv">retk</span> <span class="p">}</span>

    <span class="err">…</span><span class="nv">code</span>

    <span class="c1">;;STEP 4: if the row does not exist, insert a row into the table.</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">my-coin-table</span> <span class="nv">account</span><span class="p">{</span>
       <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="nv">amount</span>,
       <span class="s">&quot;keyset&quot;</span><span class="err">:</span> <span class="nv">keyset</span>
    <span class="err">…</span><span class="nv">code</span>
</pre></div>


<p><strong>Step 2: Check Input Key vs Row’s Keyset</strong></p>
<p>Next, use <strong>enforce</strong> to check that the input keyset is the same as the row’s keyset. If not, return that the account guards do not match.</p>
<div class="codehilite"><pre><span></span>      <span class="c1">;;STEP 2: Check that the input keyset is the same as the row&#39;s keyset</span>
      <span class="p">(</span><span class="nf">enforce</span> <span class="p">(</span><span class="nb">= </span><span class="nv">retg</span> <span class="nv">keyset</span><span class="p">)</span>
        <span class="s">&quot;account guards do not match&quot;</span><span class="p">)</span>
</pre></div>


<p><strong>Step 3: Write Row to Table</strong></p>
<p>Finally, write the account balance and keyset to a row in the my-coin-table.</p>
<div class="codehilite"><pre><span></span>      <span class="c1">;;STEP 3: Writes the row to the table. (write adds the table with the key and the row.</span>
      <span class="p">(</span><span class="nf">write</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
        <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="err">:</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span>
        , <span class="s">&quot;keyset&quot;</span>   <span class="err">:</span> <span class="nv">retg</span>
        <span class="p">})))</span>
</pre></div>


<p><strong>Final Enforce Statement</strong></p>
<p>Looking back at the final version of the code, you can see that we have completed the same logic without ever using an if statement. This again allows for simpler logic and can help you write safer code.</p>
<div class="codehilite"><pre><span></span>  <span class="c1">;;refactor with with-default-read &amp; write &amp; enforce</span>
  <span class="p">(</span><span class="nf">defun</span> <span class="nv">credit</span><span class="ss">:string</span> <span class="p">(</span><span class="nf">account</span><span class="ss">:string</span> <span class="nv">keyset</span><span class="ss">:keyset</span> <span class="nv">amount</span><span class="ss">:decimal</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">doc </span><span class="s">&quot;Credit AMOUNT to ACCOUNT balance recording DATE and DATA&quot;</span>

    <span class="c1">;;STEP 1: Default the row to balance at 0.0 and keyset at input keyset</span>
    <span class="c1">;;If row exists, then bind balance and keyset value from the table.</span>
    <span class="c1">;;This allows one time key lookup - increases efficiency.</span>
    <span class="p">(</span><span class="nf">with-default-read</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
      <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="err">:</span> <span class="mf">0.0</span>, <span class="s">&quot;keyset&quot;</span><span class="err">:</span> <span class="nv">keyset</span> <span class="p">}</span>
      <span class="p">{</span> <span class="s">&quot;balance&quot;</span><span class="ss">:=</span> <span class="nv">balance</span>, <span class="s">&quot;keyset&quot;</span><span class="ss">:=</span> <span class="nv">retg</span> <span class="p">}</span>
      <span class="c1">;;STEP 2: Check that the input keyset is the same as the row&#39;s keyset</span>
      <span class="p">(</span><span class="nf">enforce</span> <span class="p">(</span><span class="nb">= </span><span class="nv">retg</span> <span class="nv">keyset</span><span class="p">)</span>
        <span class="s">&quot;account guards do not match&quot;</span><span class="p">)</span>
      <span class="c1">;;STEP 3: Writes the row to the table. (write adds the table with the key and the row.</span>
      <span class="p">(</span><span class="nf">write</span> <span class="nv">my-coin-table</span> <span class="nv">account</span>
        <span class="p">{</span> <span class="s">&quot;balance&quot;</span> <span class="err">:</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">balance</span> <span class="nv">amount</span><span class="p">)</span>
        , <span class="s">&quot;keyset&quot;</span>   <span class="err">:</span> <span class="nv">retg</span>
        <span class="p">})))</span>
<span class="p">)</span>
</pre></div>


<p>Take a moment now to look back and compare both versions of this code. Ensure that you keep these patterns in mind as you write your own code.</p>
<hr />
<h2 id="my-coinrepl"><strong>my-coin.repl</strong><a class="headerlink" href="#my-coinrepl" title="Permanent link">&para;</a></h2>
<p>In my-coin.repl file, you can check that the failing cases of <strong>debit-if</strong> and <strong>credit-if</strong> are tested with <a href="https://pact-language.readthedocs.io/en/stable/pact-functions.html#expect" target="_blank">(expect … )</a> by checking if the output matches the expected failure message. The refactored code allows us to test with <a href="https://pact-language.readthedocs.io/en/stable/pact-functions.html#expect-failure" target="_blank">(expect-failure ...)</a> to check if the function succeeds or not.</p>
<div class="admonition summary">
<p class="admonition-title">Note</p>
<p>For more information on running .repl files from Atom, see the tutorial <a href="https://pactlang.org/beginner/contract-interaction/#4-run-repl-file" target="_blank">Contract Interaction &gt; Run REPL file</a>.</p>
</div>
<hr />
<h2 id="review"><strong>Review</strong><a class="headerlink" href="#review" title="Permanent link">&para;</a></h2>
<p>That wraps up this tutorial on Pact safety using control flow.</p>
<p>Throughout this tutorial, you learned that using <strong>enforce</strong> can help make your the control flow of your Pact smart contracts even simpler and safer. You went over a few demonstrations teaching you ways to avoid using <strong>if</strong> statements in favor of <strong>enforce</strong>.</p>
<p>This is one of a few key patterns that you can use to improve the safety of your smart contracts. Coming up, we’ll go over a few more safety tips to keep in mind as you develop Pact smart contracts.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../pact-and-javascript/" title="2. Pact and Javascript" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2. Pact and Javascript
              </span>
            </div>
          </a>
        
        
          <a href="../interfaces-with-pact/" title="4. Interfaces with Pact" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                4. Interfaces with Pact
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2019 Kadena
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/kadena-io" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/kadena_io" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
        <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-127512784-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(a){a.host!=document.location.host&&a.addEventListener("click",function(){var e=a.getAttribute("data-md-action")||"follow";ga("send","event","outbound",e,a.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
  </body>
</html>